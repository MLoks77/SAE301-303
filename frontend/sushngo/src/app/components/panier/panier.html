<app-navbar></app-navbar>

<div class="w-full h-10 mt-14 sm:mt-0 bg-black flex items-center pl-4 gap-1">
    <a routerLink="/accueil"
        class="relative text-gray-200 font-semibold hover:text-white border-b-2 border-transparent hover:border-white transition-colors duration-300">Accueil</a>
    <span class="text-white italic mb-1"> &gt; Panier</span>
</div>

<div class="flex items-center mb-2 mx-4 md:mx-10 mt-10">
    <h1 class="text-3xl Caladea ml-4"> Vous avez commandé {{ getNombreTotalProduits() }} produits. <span
            class="text-red-500 text-sm">10 produits maximum</span>
    </h1>
</div>

<!-- Messages de succès/erreur -->
<div class="mx-4 md:mx-10 mb-4">
    <div *ngIf="successMessage"
        class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative text-center">
        {{ successMessage }}
    </div>
    <div *ngIf="errorMessage"
        class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative text-center">
        {{ errorMessage }}
    </div>
</div>

<div class="grid grid-cols-1 md:grid-cols-[70%_30%] gap-4 h-auto md:h-[800px] ml-4 mr-4 md:mr-8">
    <div class="bg-gray-100 rounded-xl overflow-hidden shadow-inner">
        <div class="flex-col overflow-y-auto h-full p-4 space-y-4 bg-gray-50/50">
            <!-- Liste des produits -->
            <div *ngFor="let item of getItemsPanier(); let i = index"
                class="flex items-center bg-white p-3 rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-all relative group">

                <!-- Image -->
                <img [src]="item.produit.image" alt="{{ item.produit.nom }}"
                    class="w-20 h-20 object-cover rounded-lg mr-4">

                <!-- Détails -->
                <div class="flex-1">
                    <h3 class="font-bold text-gray-800 text-lg">{{ item.produit.nom }}</h3>
                    <p class="text-xs text-gray-500 line-clamp-2 leading-tight">{{ item.produit.description }}</p>
                </div>

                <!-- Quantité et Prix -->
                <div class="flex flex-col items-end gap-1 ml-4 text-right">
                    <span class="text-xs font-semibold bg-gray-200 text-gray-700 px-2 py-1 rounded-full">x{{
                        item.quantite }}</span>
                    <span class="text-lg font-bold text-gray-900">{{ item.prixTotal }}€</span>

                    <!-- Bouton supprimer -->
                    <button (click)="supprimerArticle(i)"
                        class="cursor-pointer hover:text-red-500 transition-colors p-1" title="Supprimer">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Message si panier vide -->
            <div *ngIf="getItemsPanier().length === 0"
                class="flex flex-col items-center justify-center h-full text-gray-400 mt-20">
                <span class="text-xl">Votre panier est vide</span>
            </div>
        </div>
    </div>

    <div class="bg-[#0C3A53] h-auto md:h-[700px] rounded-xl pb-4">
        <h1 class="text-center text-2xl font-bold text-white mt-2">Paiement</h1>
        <div class="flex flex-col items-start mx-4 md:mx-16 my-4">
            <form class="w-full" #commandeForm="ngForm" (ngSubmit)="onSubmit()">
                <label for="typecarte" class="text-white text-xl">Type de Carte</label>
                <select name="typecarte" id="typecarte" [(ngModel)]="typeCarte" required
                    class="h-[30px] w-full bg-white rounded-md">
                    <option value="" selected disabled>Choisissez un type de carte</option>
                    <option value="visa">Visa</option>
                    <option value="mastercard">Mastercard</option>
                    <option value="paypal">Paypal</option>
                    <option value="applepay">Apple Pay</option>
                    <option value="googlepay">Google Pay</option>
                    <option value="amex">American Express</option>
                </select>
                <div class="flex flex-col my-4 gap-1">
                    <label for="nomcarte" class="text-white text-md">Nom sur la carte:</label>
                    <input type="text" id="nomcarte" name="nomcarte" [(ngModel)]="nomCarte" required
                        class="h-[30px] w-full bg-white rounded-md placeholder-gray-400 px-2" placeholder="Dupont">

                    <label for="numcarte" class="text-white text-md">Numéro de la carte:</label>
                    <input type="text" id="numcarte" name="numcarte" [(ngModel)]="numCarte" required minlength="19"
                        maxlength="19" class="h-[30px] w-full bg-white rounded-md placeholder-gray-400 px-2"
                        placeholder="1111 2222 3333 4444" (input)="formatNumCarte($event)">

                    <div class="grid grid-cols-2 gap-2 h-[30px]">
                        <div>
                            <label for="dateexpiration" class="text-white text-md">Date d'expiration:</label>
                            <input type="text" id="dateexpiration" name="dateexpiration" [(ngModel)]="dateExpiration"
                                required class="h-[30px] w-full bg-white rounded-md placeholder-gray-400 px-2"
                                placeholder="MM/AA" (input)="formatDateExpiration($event)">
                        </div>
                        <div>
                            <label for="cvv" class="text-white text-md">CVV:</label>
                            <input type="text" id="cvv" name="cvv" [(ngModel)]="cvv" required minlength="3"
                                maxlength="3" class="h-[30px] w-full bg-white rounded-md placeholder-gray-400 px-2"
                                placeholder="123">
                        </div>
                    </div>
                </div>
                <div class="flex flex-col items-center justify-center mx-4 md:mx-12 my-8">
                    <h3 class="text-white text-sm">Cette commande vous fera gagner :</h3>
                    <span class="text-white text-center text-2xl font-bold mt-2">{{ getPointsFidelite() }} points de
                        fidélité</span>
                </div>
                <div class="w-full mt-6 border-t border-white">
                    <div class="flex justify-between text-white text-md font-medium">
                        <span>Total de la commande:</span>
                        <span>{{ getTotalPanier() }} €</span>
                    </div>
                    <div class="flex justify-between text-white text-md font-medium">
                        <span>Livraison:</span>
                        <span> {{ getPrixLivraison() }} €</span>
                    </div>
                    <div class="flex justify-between text-white text-md font-medium">
                        <span>Réduction: </span>
                        <span>{{ getReduction() }}€</span>
                    </div>
                    <div class="flex justify-center gap-4 mt-6">
                        <button type="button" (click)="isLivraison = true" [class.bg-white]="isLivraison"
                            [class.text-black]="isLivraison" [class.bg-gray-700]="!isLivraison"
                            [class.text-white]="!isLivraison"
                            class="px-4 py-2 cursor-pointer rounded-full font-semibold transition-colors border border-white">
                            Livraison
                        </button>
                        <button type="button" (click)="isLivraison = false" [class.bg-white]="!isLivraison"
                            [class.text-black]="!isLivraison" [class.bg-gray-700]="isLivraison"
                            [class.text-white]="isLivraison"
                            class="px-4 py-2 cursor-pointer rounded-full font-semibold transition-colors border border-white">
                            À emporter
                        </button>
                    </div>
                    <button type="submit"
                        class="w-full bg-black text-white font-bold py-3 rounded-xl hover:bg-gray-800 cursor-pointer transition shadow-lg mt-6 flex justify-between px-6 items-center group">
                        <span>Passer au paiement</span>
                        <span class="bg-white/20 px-2 py-1 rounded text-sm group-hover:bg-white/30 transition">{{
                            getTotalApresReduction().toFixed(2) }}€</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
<app-footer></app-footer>